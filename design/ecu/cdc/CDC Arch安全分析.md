本文的核心目标旨在深入分析APP涉及的控制流程的安全性问题，并主要围绕以下内容进行详细展示：
* 简要分析CDC（Cockpit Domain Controller）系统架构，包括主要组件、通信介质等；
* APP所涉及的ECU及传感器的控制流分析。

# 1. CDC总系统架构及通信模型

本节将对CDC系统的架构进行精要分析，涵盖其主要组成部分、通信介质等关键要素。

![](https://raw.githubusercontent.com/carloscn/images/main/typora202312211108830.png)

如图所示为车载娱乐系统架构图，我们可以看到系统由多个硬件组件构成，它们通过各种通信协议和接口互连。以下是对此系统一些关键组件和特性的简要介绍：

1. **核心处理模块**：系统的中心是一个多功能的模块（标记为MT8676），属于处理中心，负责协调各个组件的数据处理和流程控制。X-RoomOS就在该Module上运行。
2. **SOC（系统芯片）**：另一个关键组件是TDA4VM，它是专门为车载系统设计的SoC，集成了多个处理器核心、图形处理单元、以及多媒体处理器等。
3. **通信接口**：系统包含多个通信接口，如Wi-Fi/蓝牙天线、以态网开关、USB集线器等，这些接口使得系统能够与外界设备进行多种形式的数据交换。
4. **显示和摄像头接口**：图中提到了多个显示输出（不同尺寸和分辨率的屏幕）和摄像头输入，这些是车载娱乐系统的重要组成部分，用于提供视频内容和支持车辆的环境感知功能。
5. **音频处理**：提到了音频接口，这表明系统具有处理和输出音频信号的能力，为乘客提供音乐播放和其他音频服务。
6. **扩展接口**：系统还有一系列的扩展接口，包括CAN总线和控制IO，这些通常用于车辆的诊断、监控和控制系统。
7. **存储和序列化/反序列化组件**：系统中还涉及数据的存储以及为长距离传输高速数据而设计的序列化/反序列化组件。

# 2. CDC通信模型

## 2.1 物理层通信链路

根据当前获取的信息和方案，涉及到的控制器主要包括 **XCU和CDC**。如下图所示，这一通信链路由红色箭头标示。此通信链路是通过以太网方式实现数据传输和通信的。

![](https://raw.githubusercontent.com/carloscn/images/main/typora202312211406566.png)

## 2.2 DDS通信

  
DDS（Data Distribution Service）是一种中间件协议，用于实现高性能、数据密集型应用程序之间的可靠、实时、点对点的数据交换。它由OMG（Object Management Group）制定，广泛应用于需要实时数据传输的领域，如军事、航空、汽车、机器人、工业自动化等。

### 核心特征
1. **实时性**：DDS 提供了低延迟的数据传输机制，适用于实时系统。
2. **可靠性**：它能确保数据可靠传输，即使在网络条件不佳的情况下。
3. **数据分发**：DDS支持数据的发布/订阅模型，允许数据生产者（发布者）发布数据，而数据消费者（订阅者）订阅感兴趣的数据，只接收他们需要的信息。
4. **弹性和可伸缩性**：DDS能够动态地适应参与者的加入和离开，而且可以扩展到大量的节点。
5. **质量服务（QoS）策略**：DDS定义了一系列QoS策略，允许用户细粒度地控制通信行为，如延迟、吞吐量、可靠性和资源使用等。
6. **位置透明**：在DDS中，数据的发布者和订阅者可以在不考虑对方物理位置的情况下进行通信。
    
### 工作原理

- **域**：DDS网络被划分为域，每个域是一个独立的通信环境。
- **参与者**：在每个域中，参与者（发布者和订阅者）通过创建话题来交换数据。
- **话题**：话题是数据类型和QoS策略的组合，定义了数据的交换方式。
- **数据写入者/读取者**：数据写入者负责发布话题数据，数据读取者负责接收数据。

总的来说，DDS提供了一个高效、灵活、可靠的方式来确保实时系统中的数据在正确的时间到达正确的地点。

### 安全特性

DDS（Data Distribution Service）为数据通信提供了多种安全特性，主要是为了保证数据在传输过程中的保密性、完整性、可靠性以及访问控制。以下是一些在使用DDS时需要注意的安全特性：
1. **认证**：DDS支持对参与者进行认证，确保只有合法的实体可以加入到DDS域中进行数据交换。
2. **访问控制**：它允许定义访问控制策略，这样只有被授权的参与者才能发布或订阅特定的话题。
3. **加密**：DDS可以加密数据以保护其在网络传输过程中的保密性。它支持对消息内容进行端到端的加密。
4. **完整性**：DDS能够确保数据在传输过程中不会被篡改，可以通过数字签名等技术来实现。
5. **抗拒绝服务（DoS）攻击**：DDS应该具备一定的机制来检测和缓解拒绝服务攻击，以保持服务的可用性。

可以具体参考： https://www.omg.org/spec/DDS-SECURITY/1.1/About-DDS-SECURITY

## 2.3 通信

这个框图描述了一种通信链路的架构，包括多个组件和它们之间的连接：

![](https://raw.githubusercontent.com/carloscn/images/main/typoratypora202312211706351.png)

1. **X-NAV (ECU)**：这是一个获取坐标数据的控制单元，在这里被标记为 X-NAV。它可能是负责自动驾驶导航、坐标导航相关的控制功能。
2. **XCU (x86_ubuntu)**：XCU 是一个运行在 x86 架构上的 Ubuntu 系统的控制单元。XCU 执行更复杂计算的中央处理单元。
3. **CDC**：这是座舱的控制单元， 包含MT8676 操作系统为xRoomOS的硬件。它还包含了一个名为 xNavi APP 的应用程序，这是一个导航应用。
4. **xrt 和 xrt (hal layer)**：xrt 可能指的是一个软件框架或接口，负责管理不同组件之间的通信。在XRoomOS端，HAL 层（硬件抽象层）意思是xrt在XRoomOS端单元中提供了一个抽象层，使得应用程序（如 xNavi APP）可以与底层硬件通信。
5. **通信路径**：
    - **A**：指向 xNavi APP 的箭头表示 CDC 与某个名为“高精SDK或googleSDK”的外部服务或库之间的通信。使用HTTPS进行通信。
    - **B**：表示 XCU 与 CDC 之间的通信链路。使用DDS进行通信，关于其安全特性可以参考 https://fast-dds.docs.eprosima.com/en/latest/fastdds/security/security.html
    - **C**：表示 X-NAV (ECU) 与 XCU 之间的通信链路。在XCU里面通过DDS广播进行数据传输，利用DDS的订阅-话题特性，订阅了DDS话题的应用就可以接收到数据。

在XCU中，使用XRT提取数据是有相关的限制的，只有规定种类的数据可以使用XCU的数据，可以参考：[https://wiki.autox.clu/doc/xview-interface-kNELwTTYTH](https://wiki.autox.clu/doc/xview-interface-kNELwTTYTH "https://wiki.autox.clu/doc/xview-interface-kNELwTTYTH")

| 数据类型           | 数据说明 |
|------------------|-------|
| SimulationWorld  |       |
| xTaxiMessage     |       |
| RoutePath        |       |
| HMIAction        |       |
| Routing          |       |
| Pullover         |       |
| DrivingStatus    |       |
| PreviewRoutePath |       |
